{
  "hash": "33fc81dc4600d8462339006c98e49046",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: The buddy scheme\ntoc: true\ninclude-in-header: \n  - _includes/fontawesome.html\n---\n\n## Next buddy pairings\n\n\n::: {.cell}\n\n:::\n\n\n:::: {.columns}\n::: {.column width=\"40%\"}\n![](images/rainbowR-latest-buddies.png)\n:::\n\n::: {.column width=\"5%\"}\n\n:::\n\n::: {.column width=\"55%\"}\nThe sign-up form is open for the next round of the buddy scheme.\n\nIt closes on **Monday September 1st, 2025** and e-mails introducing the buddy pairs will be sent on **Tuesday September 2nd.**\n\n`<a href=\"https://docs.google.com/forms/d/1glkiStYfpcf61GQ33fqB9ohdnJ_rm7Ax6HfVMKghSqM/\" class=\"icon-link\" target=\"_blank\" rel=\"noopener\"><i class=\"fas fa-list\"></i> sign-up form</a>`{=html}\n:::\n::::\n\n## About the buddy scheme\n\nThe buddies scheme provides an opportunity to foster deeper connections between members of the rainbowR community, encouraging conversations between people who may not meet otherwise. We envisage this buddy scheme as primarily **social** -- you don't *have* to talk about R, though it will be something you have in common. Any experience level with R is welcome! \n\n## How it works\n\n- Folks opt-in via this [sign-up form](https://docs.google.com/forms/d/1glkiStYfpcf61GQ33fqB9ohdnJ_rm7Ax6HfVMKghSqM/)\n- Buddy pairs are randomly assigned\n- E-mails are sent to each pair making the introduction.\n\nThis is implemented in R, as outlined below.\n\nWe trust that the assigned buddies will want to communicate with each other, and get in touch with each other via email. We anticipate that buddies will arrange a meet-up (most likely online), though there is no firm requirement to do so.^[If you haven't had any contact at all from your buddy after a month, email [hello@rainbowr.org](mailto:hello@rainbowr.org) and we'll try and pair you with someone else.]\n\nIn the form we ask for a little about yourself and things that you'd be interested in talking about or doing together, and give some examples of things you might consider:\n\n- Discuss/get feedback on a project you're working on (either R-related or something completely different)\n- Explore a [tidyRainbow](https://github.com/r-lgbtq/tidyrainbow) dataset together\n- Work on some [Advent of Code](https://adventofcode) puzzles together (either new ones in December or some from previous years)\n- Do some [pair programming](https://en.wikipedia.org/wiki/Pair_programming) \n- Play some online games, e.g. some of those listed [here](https://www.google.com/url?sa=j&url=https%3A%2F%2Fwww.thegamer.com%2Fbest-free-web-browser-party-games%2F&uct=1694511574&usg=t0zNc9gJyPFNYBSey58bx0wl2w8.&source=editors)\n- General chat is fine too!\n\nTo help get the conversation started, what you write about yourself and your interests will be included in the emails introducing each buddy pair (though buddies are assigned randomly, not on mutual interests).\n\nWe run the scheme every three months, and the way it's implemented ensures that you'll always be paired with someone you haven't been paired with before.^[As long as you always sign-up with the same e-mail address.]\n\n## Keeping it safe\nWe want the scheme to be fun and safe for everyone, so it operates under the rainbowR [code of conduct](CoC.qmd). All the information entered in the sign-up form is confidential. It is seen just by me^[[Ella Kaye](https://ellakaye.co.uk), the organiser of the scheme] and the assigned buddies. There is a GitHub [repo](https://github.com/r-lgbtq/buddies) for the implementation of the scheme, but no personal details will ever be checked in there. If you're interested in taking part but have any questions or concerns, please email [hello@rainbowr.org](mailto:hello@rainbowr.org) and I will do my best to address them. \n\n## Implementation\n\nSince rainbowR members are interested in R, here's an outline and desciption of the code. For the full implementation, the [code is on GitHub](https://github.com/r-lgbtq/buddies/blob/main/buddies.R).\n\nThe sign-up form is a Google Form, and the responses are stored in a Google Sheet. The data is read into R using the [**googlesheets4**](https://googlesheets4.tidyverse.org) package. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(googlesheets4)\nurl <- \"https://docs.google.com/spreadsheets/d/BUDDIES_SHEET_ID/\"\nbuddy_form <- read_sheet(url)\n```\n:::\n\n\nThe code chunk above isn't evaluated in this post, so here's a dummy table to demonstrate on instead:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nbuddy_df <- tribble(\n  ~first_name, ~last_name,  ~email, ~about, ~interests,\n  \"Alice\", \"S\", \"alice@example.com\", \"I'm a data scientist at a small company in London\", \"I'm interested in data visualisation and machine learning. I'd like to discuss a project I'm working on, and maybe do some pair programming.\",\n  \"Bob\", \"T\", \"bob@example.com\", \"I'm a student in a small town in California\", \"I'd like to chat and play some online games.\",\n  \"Charlie\", \"U\", \"charlie@example,com\", \"I'm an author and just starting to explore R\", \"I'd love to explore a TidyRainbow dataset together.\",\n  \"Dana\", \"V\", \"dana@example.com\", \"I'm a software engineer in a big company in New York\", \"Doing some Advent of Code puzzles together sounds fun!\"\n)\n```\n:::\n\n\nThen there's some code to check the number of responses, and prompt me to sign-up if there's an odd number. Everyone who signs up will get a buddy!\n\nNext, we define a function that randomly assigns pairs, using some [**dplyr**](https://dplyr.tidyverse.org) wrangling:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmake_buddy_pairs <- function(buddy_df, seed = 1) {\n  \n  # set the seed to seed\n  set.seed(seed)\n  \n  # create a vector pairs which repeats each of the numbers from 1\n  # to half the number in buddy_df and shuffles them (assume even number)\n  pairs <- sample(rep(1:(nrow(buddy_df)/2), 2))\n  \n  # add pairs to buddy_df\n  buddy_df <- buddy_df |>\n    mutate(pair = pairs) |> \n    arrange(pair)\n  \n  # from buddy_df create a tibble buddy_pairs with half the rows of buddy_df \n  # with a column called pair with the numbers 1 to half the number of rows in buddy_df\n  # a column called buddy1 with the first email associated with pair \n  # and a column called buddy2 with the second email associated with pair\n  buddy_pairs <- buddy_df |>\n    group_by(pair) |>\n    summarise(buddy1 = email[1],\n              buddy2 = email[2])\n  \n  # in buddy_pairs, create first_buddy which is the lesser of buddy1 and buddy2\n  # and create second_buddy which is the greater of buddy1 and buddy2\n  # then select first_buddy and second_buddy\n  # this will make it easier to compare buddy_pairs with previous_buddy_pairs later\n  buddy_pairs <- buddy_pairs |>\n    mutate(first_buddy = pmin(buddy1, buddy2),\n           second_buddy = pmax(buddy1, buddy2)) |>\n    select(first_buddy, second_buddy)\n  \n  return(list(buddy_pairs = buddy_pairs,\n              buddy_df = buddy_df))\n}\n```\n:::\n\n\nRunning that would be enough to determine the pairings, but we're already thinking ahead to future runs, and want to set things up so that people don't get the same buddy twice. We'll manage that by storing previous pairings in `previous_buddy_pairs.csv`, checking if any of the new pairings match any of those, and rerunning `make_buddy_pairs()` with different seeds until there are no matches. The `make_buddies()` function does that:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmake_buddies <- function(buddy_df, seed = 1) {\n  \n  # sanity check if buddy_df has an odd number of rows\n  if(nrow(buddy_df) %% 2 == 1) {\n    stop(\"buddy_df must have an even number of rows\")\n  }\n  \n  # first run\n  buddies <- make_buddy_pairs(buddy_df, seed)\n  buddy_pairs <- buddies$buddy_pairs\n  buddy_df <- buddies$buddy_df\n  \n  # if previous_buddy_pairs.csv exists, read it into previous_buddy_pairs\n  # if not, create it\n  if(file.exists(\"previous_buddy_pairs.csv\")) {\n    previous_buddy_pairs <- read_csv(\"previous_buddy_pairs.csv\")\n  } else {\n    previous_buddy_pairs <- tibble(first_buddy = character(),\n                                   second_buddy = character())\n  }\n  \n  # while any of the rows in buddy_pairs are in previous_buddy_pairs\n  # increment seed by 1 and run make_buddy_pairs again, \n  # updating buddy_pairs and buddy_df\n  while(any(apply(buddy_pairs, 1, function(x) paste(x, collapse = \" \")) %in% \n            apply(previous_buddy_pairs, 1, function(x) paste(x, collapse = \" \")))) {\n    seed <- seed + 1\n    updated_buddies <- make_buddy_pairs(buddy_df, seed)\n    buddy_pairs <- updated_buddies$buddy_pairs\n    buddy_df <- updated_buddies$buddy_df\n  }\n    \n  # create updated_buddy_pairs and write it to previous_buddy_pairs.csv\n  updated_buddy_pairs <- bind_rows(previous_buddy_pairs, buddy_pairs)\n  # Don't write the csv during the blog post demo!\n  # write_csv(updated_buddy_pairs, \"previous_buddy_pairs.csv\")\n  \n  # return a list with buddy_pairs, buddy_df, and seed\n  return(list(buddy_pairs = buddy_pairs,\n              buddy_df = buddy_df,\n              final_seed = seed))\n}\n```\n:::\n\n\nWe're now ready assign buddies!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuddies <- make_buddies(buddy_df)\nbuddies_df <- buddies$buddy_df\n```\n:::\n\n\nNext, we need to wrangle the data into a format that's useful for sending emails. We're going to use the [**blastula**](https://pkgs.rstudio.com/blastula/index.html) package to send emails, which requires a data frame with one row per pair:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuddies_for_email <- buddies_df |>\n  group_by(pair) |>\n  summarise(first_name1 = first_name[1],\n            first_name2 = first_name[2],\n            last_name1 = last_name[1],\n            last_name2 = last_name[2],\n            email1 = email[1],\n            email2 = email[2],\n            about1 = about[1],\n            about2 = about[2],\n            interests1 = interests[1],\n            interests2 = interests[2])\n```\n:::\n\n\nAdapting an [example by James Balamuta](https://thecoatlessprofessor.com/programming/r/sending-an-email-from-r-with-blastula-to-groups-of-students/), we next create a function that takes a data frame with one row per pair and composes an email from a template, for example:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuddies_email_template = function(buddies) {\n\n  buddies |> \n    glue_data(\n      \"Hello {first_name1} {last_name1} and {first_name2} {last_name2},\\n\\n\\n\\n\",\n      \"You are now rainbowR buddies! \\n\\n\\n\\n\",\n      \"**About {first_name1}**: {about1} \\n\\n\\n\\n\",\n      \"**About {first_name2}**: {about2} \\n\\n\\n\\n\",\n      \"**{first_name1}** is interested in {interests1}. \\n\\n\\n\\n\",\n      \"**{first_name2}** is interested in {interests2}. \\n\\n\\n\\n\",\n      \"You can contact each other at [{email1}](mailto:{email1}) and [{email2}](mailto:{email2}).\\n\\n\\n\\n\",\n      \"Over to you! \\n\\n\\n\\n\"\n    )  |> \n    md()  |> \n    compose_email()\n}\n```\n:::\n\n\nFinally, we loop over the rows of `buddies_for_email`, compose an email for each pair, and send it, using previously stored credentials:^[[Instructions for setting up SMTP cedentials](https://pkgs.rstudio.com/blastula/articles/sending_using_smtp.html)]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfor (i in seq_len(nrow(buddies_for_email))) {\n  # Retrieve current buddies\n  buddy_pair <- buddies_for_email[i, ] \n  \n  # get email addresses\n  to <- c(buddy_pair$email1, buddy_pair$email2)\n  \n  # Construct the e-mail using our custom template.\n  email_contents <- buddies_email_template(buddy_pair)\n  \n  # Send e-mail\n  email_contents %>%\n    smtp_send(\n      from = \"hello@rainbowr.org\",\n      to = to,\n      subject = \"Your new rainbowR buddy!\",\n      credentials = creds_key(id = \"rainbowr\")\n    )\n}\n```\n:::\n\n\nThat's it! Buddy pairs are now introduced and it's over to them to get to know each other.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}